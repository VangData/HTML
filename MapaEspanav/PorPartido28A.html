<html lang="es">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Elecciones 10 de Noviembre de 2019</title>


<script src='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
<script type="text/javascript" src="https://rawcdn.githack.com/VangData/prova/303a4dd5dd7d718c2ecab4b40035ce5baa53e662/junto_cartodb_1_mergeb.js"></script>
<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.min.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.0.0/mapbox-gl-geocoder.css' type='text/css' />
<link href='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
<script src='https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.css' rel='stylesheet' />
<link rel="stylesheet" type="text/css" href="style.css">
<script src='https://cdn.rawgit.com/duroty/responsive/master/app.embed.js'></script>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" rel="stylesheet"> <!-- CAMBIAR3 -->


<body>
  <div id="cabecera">
    <nav id="menuPartidos">

    </nav>

  </div>

  <div id='map'>
    <!-- COPIAR1 INICIO-->
    <div id='legend' style="opacity: 0"> 
      <nav class='legend clearfix'>
        <h1>Porcentaje de voto:</h1></br>
        <span id="legend1" style='background:#565454;opacity:0.1;'></span>
        <span id="legend2" style='background:#565454;opacity:0.4;'></span>
        <span id="legend3" style='background:#565454;opacity:0.6;'></span>
        <span id="legend4" style='background:#565454;opacity:0.75;'></span>
        <span id="legend5" style='background:#565454;opacity:1;'></span>
        <label>0-10</label>
        <label>10-20</label>
        <label>20-30</label>
        <label>30-40</label>
        <label>+40</label>
      </nav></div></div>
      <div id='geocoder' class='geocoder'></div>
      <p id="textoExplicativo">*OTROS: Partidos nacionalistas o regionalistas (ERC, Junts per Catalunya, Cup, PNV, EH Bildu, Coalición Canaria, BNG, Teruel Existe y CP Melilla).</p>
      <!-- COPIAR1 FIN-->
      


      <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibGF1cjA1IiwiYSI6ImNpbmtmM2FjazAwODF2eG0yNjhteTcxdHIifQ.l7uzjVe2b1L8dHh_Z9JjoQ';
        
        var map = new mapboxgl.Map({
          container: 'map', // container id
          style: 'mapbox://styles/laur05/cjuvi3xkc8dik1fmtpwe3xjhh', 
          center:  [-4.0222, 38.7], // starting position [lng, lat]
          zoom: isMobile ? 3 : 5,// starting zoom
          minZoom: 2,
          maxZoom: 12,
          attributionControl: false,
          //maxBounds: [[-19,27],[9,45] ]
        });
        
        var hoveredStateId =  null;
        var searched_lngLat = null;
        const to_ES = (number, digits=0) => number.toLocaleString("es", {
          minimumFractionDigits: digits, 
          maximumFractionDigits: digits})

         var totalWidth = window.innerWidth,
        isMobile = totalWidth < 500;

        


        map.on('load', function () {

              // Add a layer showing the state polygons.
              map.addSource("resultados", {
                type: 'vector',
                url: 'mapbox://laur05.8b4mt3n2',
              });

              map.addSource("resultadosTodos", {
                  type: 'vector',
                  url: 'mapbox://laur05.ak3lun20',
              });

              var layers = map.getStyle().layers;

              //cc001e > PSOE  //#3dc8ff > PP  //#ad18ad > PODEMOS  //#ff9324 > CIUDADANOS
              //#3c8c04 > VOX  //#ffd332 > INDEPES   //#ed5975 > junts per cat   //#2b7438 > PNV  //#a2d213 > EHbildu  //#05dfc6 > MAS PAIS  //#abaf1d > PACMA  //#fff200 > CUP


              // CAPAS TODOS JUNTOS
              map.addLayer({
                'id': 'tiles-fills',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultadosTodos',
                'source-layer': 'ganador10N',
                'filter': ['>', 'Perc_PrimeraForca', -1],  // 1a capa que se pintará (TODOS)
                'paint': {
                'fill-color': ["match", ["get","Nom_PrimeraForca"],
        "PSOE", "#cc001e",
        "PP", "#3dc8ff",
        "NA+", "#026ca5",
        "JxCat", "#023382",
        "Bildu", "#95ab6a",
        "ERC", "#e8c60b",
        "Cs", "#ff9324",
        "CC", "#e8de74",
        "CUP", "#e8de74",
        "Podemos", "#ad18ad",
        "VOX", "#52b80b",
        "BNG", "#b5f3f7",
        "PNV", "#008c7b",
        "Teruel Existe", "#094f1c",
        "CP Melilla", "#094f1c",
        "MAS PAIS", "#00e6cc",
        "PRC", "#3236a8",
        "#d6d6d6"],
'fill-opacity': ["interpolate", ["linear", 100], ["get", "Perc_PrimeraForca"],
        0.00, 0.05,
        5, 0.2,
        10, 0.4,
        30, 0.6,
        40, 0.8,
        50, 1.0]
}}, "admin");

                map.addLayer({
                'id': 'tiles-borders-todos',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'resultadosTodos',
                'source-layer': 'ganador10N',
                'paint': {
"line-color": ["case", ["boolean", ["feature-state", "hover"], false], "black", "white"],
            "line-width": ["case", ["boolean", ["feature-state", "hover"], false], 2, 0]}
    }, "admin");


              // CAPAS SEPARADAS PARTIDOS
              map.addLayer({
                'id': 'tiles-fills-PSOE',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'PSOE', -1], // No se pintará la capa pq no hay ningún valor negativo
                'paint': {
                'fill-color': '#cc001e',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", 'PSOE'],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");

              map.addLayer({
                'id': 'tiles-fills-PPNA',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'PPNA', -1],
                'paint': {
                'fill-color': '#3dc8ff',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", "PPNA"],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");

              map.addLayer({
                'id': 'tiles-fills-Cs',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'Cs', -1],
                'paint': {
                'fill-color': '#ff9324',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", "Cs"],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");

              map.addLayer({
                'id': 'tiles-fills-PODEMOS',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'PODEMOS', -1],
                'paint': {
                'fill-color': '#ad18ad',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", "PODEMOS"],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");


              map.addLayer({
                'id': 'tiles-fills-VOX',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'VOX', -1],
                'paint': {
                'fill-color': '#52b80b',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", "VOX"],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");

              map.addLayer({
                'id': 'tiles-fills-Regionalistas',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'INDEPES',-1],
                'paint': {
                'fill-color': '#ffd332',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", "Regionalistas"],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");


              map.addLayer({
                'id': 'tiles-fills-COMPROMIS',
                'type': 'fill',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'fuerzasr10N',
                'filter': ['==', 'COMPROMIS',-1],
                'paint': {
                'fill-color': '#00e6cc',
                'fill-opacity': ["interpolate", ["linear", 100], ["get", "COMPROMIS"],
                        0.0, 0.04,
                        0.1, 0.1,
                        9.9, 0.1,
                        10, 0.4,
                        19.9, 0.4,
                        20, 0.6,
                        29.9, 0.6,
                        30, 0.75,
                        39.9, 0.75,
                        40, 0.9]
              }}, "admin");



              map.addLayer({
                'id': 'tiles-borders',
                'type': 'line',
                'renderingMode': '2d',
                'source': 'resultados',
                'source-layer': 'partits10N',
                'paint': {
                  "line-color": ["case", ["boolean", ["feature-state", "hover"], false], "black", "white"],
                  "line-width": ["case", ["boolean", ["feature-state", "hover"], false], 2, 0]}
                }, "admin");





              // ZOOMS

              // Add zoom and rotation controls to the map.
              var nav = new mapboxgl.NavigationControl( {showCompass:false});

              map.addControl(nav, 'top-left');

              // disable map zoom when using scroll
              map.scrollZoom.disable();


              // BUSCADOR

              var geocoder = new MapboxGeocoder({
                //country: 'es',
                accessToken: mapboxgl.accessToken,
                mapboxgl: mapboxgl,
                types: 'region, place, locality',
                placeholder: 'Busca tu calle',
                zoom: 12,
              });


              map.addControl(geocoder, 'top-right');

              var popup = new mapboxgl.Popup({
                closeButton: false,
                closeOnClick: false,
              }); 


              geocoder.on('result', function(ev) {
                searched_lngLat = mapboxgl.LngLat.convert(ev.result.center)      
              });

          // TOOLTIPS TODOS

              map.on('mousemove', 'tiles-fills', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultadosTodos', 
                      sourceLayer: 'ganador10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultadosTodos', 
                    sourceLayer: 'ganador10N',
                    id: hoveredStateId}, { hover: true});
                }
                 map.getCanvas().style.cursor = 'pointer';
 
                var colorganador = e.features[0].properties.Nom_PrimeraForca == 'PSOE' ? "#cc001e": e.features[0].properties.Nom_PrimeraForca == 'PP' ? "#026ca5": 
                e.features[0].properties.Nom_PrimeraForca == 'NA+' ? "#026ca5":e.features[0].properties.Nom_PrimeraForca == 'JxCat' ? "#023382":e.features[0].properties.Nom_PrimeraForca == 'Bildu' ? "#95ab6a": 
                e.features[0].properties.Nom_PrimeraForca == 'ERC' ? "#e8c60b":e.features[0].properties.Nom_PrimeraForca == 'Cs' ? "#d57928":e.features[0].properties.Nom_PrimeraForca == 'CC' ? "#e8de74":e.features[0].properties.Nom_PrimeraForca == 'Podemos' ? "#8e244f":e.features[0].properties.Nom_PrimeraForca == 'VOX' ? "#9cc628":e.features[0].properties.Nom_PrimeraForca == 'MAS PAIS' ? "#78e4b9":e.features[0].properties.Nom_PrimeraForca == 'PNV' ? "#008c7b":
                e.features[0].properties.Nom_PrimeraForca == 'PRC' ? "#3236a8":e.features[0].properties.Nom_PrimeraForca == 'CUP' ? "#e8de74":e.features[0].properties.Nom_PrimeraForca == 'CP Melilla' ? "#0d6925":e.features[0].properties.Nom_PrimeraForca == 'Teruel Existe' ? "#0d6925":"#c6c6c6";
                var colorsegundo = e.features[0].properties.Nom_SegonaForca == 'PSOE' ? "#cc001e": e.features[0].properties.Nom_SegonaForca == 'PP' ? "#026ca5": 
                e.features[0].properties.Nom_SegonaForca == 'NA+' ? "#026ca5":e.features[0].properties.Nom_SegonaForca == 'JxCat' ? "#023382":e.features[0].properties.Nom_SegonaForca == 'Bildu' ? "#95ab6a": 
                e.features[0].properties.Nom_SegonaForca == 'ERC' ? "#e8c60b":e.features[0].properties.Nom_SegonaForca == 'Cs' ? "#d57928":e.features[0].properties.Nom_SegonaForca == 'CC' ? "#e8de74":e.features[0].properties.Nom_SegonaForca == 'Podemos' ? "#8e244f":e.features[0].properties.Nom_SegonaForca == 'VOX' ? "#9cc628":e.features[0].properties.Nom_SegonaForca == 'MAS PAIS' ? "#78e4b9":e.features[0].properties.Nom_SegonaForca == 'PNV' ? "#008c7b":
                e.features[0].properties.Nom_SegonaForca == 'PRC' ? "#3236a8":e.features[0].properties.Nom_SegonaForca == 'CUP' ? "#e8de74":e.features[0].properties.Nom_PrimeraForca == 'CP Melilla' ? "#0d6925":e.features[0].properties.Nom_PrimeraForca == 'Teruel Existe' ? "#0d6925":"#c6c6c6";
                 var colortercero = e.features[0].properties.Nom_TerceraForca == 'PSOE' ? "#cc001e": e.features[0].properties.Nom_TerceraForca == 'PP' ? "#026ca5": 
                e.features[0].properties.Nom_TerceraForca == 'NA+' ? "#026ca5":e.features[0].properties.Nom_TerceraForca == 'JxCat' ? "#023382":e.features[0].properties.Nom_TerceraForca == 'Bildu' ? "#95ab6a": 
                e.features[0].properties.Nom_TerceraForca == 'ERC' ? "#e8c60b":e.features[0].properties.Nom_TerceraForca == 'Cs' ? "#d57928":e.features[0].properties.Nom_TerceraForca == 'CC' ? "#e8de74":e.features[0].properties.Nom_TerceraForca == 'Podemos' ? "#8e244f":e.features[0].properties.Nom_TerceraForca == 'VOX' ? "#9cc628":e.features[0].properties.Nom_TerceraForca == 'MAS PAIS' ? "#78e4b9":e.features[0].properties.Nom_TerceraForca == 'PNV' ? "#008c7b":
                e.features[0].properties.Nom_TerceraForca == 'PRC' ? "#3236a8":e.features[0].properties.Nom_TerceraForca == 'CUP' ? "#e8de74":e.features[0].properties.Nom_PrimeraForca == 'CP Melilla' ? "#0d6925":e.features[0].properties.Nom_PrimeraForca == 'Teruel Existe' ? "#0d6925":"#c6c6c6";
                var colorcuarto = e.features[0].properties.Nom_QuartaForca == 'PSOE' ? "#cc001e": e.features[0].properties.Nom_QuartaForca == 'PP' ? "#026ca5": 
                e.features[0].properties.Nom_QuartaForca == 'NA+' ? "#026ca5":e.features[0].properties.Nom_QuartaForca == 'JxCat' ? "#023382":e.features[0].properties.Nom_QuartaForca == 'Bildu' ? "#95ab6a": 
                e.features[0].properties.Nom_QuartaForca == 'ERC' ? "#e8c60b":e.features[0].properties.Nom_QuartaForca == 'Cs' ? "#d57928":e.features[0].properties.Nom_QuartaForca == 'CC' ? "#e8de74":e.features[0].properties.Nom_QuartaForca == 'Podemos' ? "#8e244f":e.features[0].properties.Nom_QuartaForca == 'VOX' ? "#9cc628":e.features[0].properties.Nom_QuartaForca == 'MAS PAIS' ? "#78e4b9":e.features[0].properties.Nom_QuartaForca == 'PNV' ? "#008c7b":
                e.features[0].properties.Nom_QuartaForca == 'PRC' ? "#3236a8":e.features[0].properties.Nom_QuartaForca == 'CUP' ? "#e8de74":e.features[0].properties.Nom_PrimeraForca == 'CP Melilla' ? "#0d6925":e.features[0].properties.Nom_PrimeraForca == 'Teruel Existe' ? "#0d6925":"#c6c6c6";
                var colorquinto = e.features[0].properties.Nom_CinquenaForca == 'PSOE' ? "#cc001e": e.features[0].properties.Nom_CinquenaForca == 'PP' ? "#026ca5": 
                e.features[0].properties.Nom_CinquenaForca == 'NA+' ? "#026ca5":e.features[0].properties.Nom_CinquenaForca == 'JxCat' ? "#023382":e.features[0].properties.Nom_CinquenaForca == 'Bildu' ? "#95ab6a": 
                e.features[0].properties.Nom_CinquenaForca == 'ERC' ? "#e8c60b":e.features[0].properties.Nom_CinquenaForca == 'Cs' ? "#d57928":e.features[0].properties.Nom_CinquenaForca == 'CC' ? "#e8de74":e.features[0].properties.Nom_CinquenaForca == 'Podemos' ? "#8e244f":e.features[0].properties.Nom_CinquenaForca == 'VOX' ? "#9cc628":e.features[0].properties.Nom_CinquenaForca == 'MAS PAIS' ? "#78e4b9":e.features[0].properties.Nom_CinquenaForca == 'PNV' ? "#008c7b":
                e.features[0].properties.Nom_CinquenaForca == 'PRC' ? "#3236a8":e.features[0].properties.Nom_CinquenaForca == 'CUP' ? "#e8de74":e.features[0].properties.Nom_PrimeraForca == 'CP Melilla' ? "#0d6925":e.features[0].properties.Nom_PrimeraForca == 'Teruel Existe' ? "#0d6925":"#c6c6c6";
                
        var coordinates = e.features[0].geometry.coordinates.slice();
        var ganador = e.features[0].properties.Nom_PrimeraForca;
        var segundo = e.features[0].properties.Nom_SegonaForca;
        var tercero = e.features[0].properties.Nom_TerceraForca;
        var cuarto = e.features[0].properties.Nom_QuartaForca;
        var quinto = e.features[0].properties.Nom_CinquenaForca;
        var sexto = e.features[0].properties.Nom_SisenaForca;
        var municipio = e.features[0].properties.MUNICIPIO;
        var provincia = e.features[0].properties.PROVINCIA;
        var pganador = e.features[0].properties.Perc_PrimeraForca.toLocaleString();
        var psegundo = e.features[0].properties.Perc_SegonaForca.toLocaleString();
        var ptercero = e.features[0].properties.Perc_TerceraForca.toLocaleString();
        var pcuarto = e.features[0].properties.Perc_QuartaForca.toLocaleString();
        var pquinto = e.features[0].properties.Perc_CinquenaForca.toLocaleString();
        var psexto = e.features[0].properties.Perc_SisenaForca.toLocaleString();
        
         popup.setLngLat(e.lngLat)
            .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans; text-transform: uppercase'><b>" + municipio + "</b></br></div><div style='font-family: Open Sans, Helvetica;'>" + provincia + "</div></div><div style='color:black;font-size:8px;font-family: OpenSans-bold, Open Sans;'><table style='border-collapse: collapse; font-family: Open Sans;width:100%'><tbody><tr><th></th><th style='text-align:right'><span style='font-size:10px'>Porcentaje %</span></th></tr><tr style='border-bottom: 1px solid #ddd;'><td style='padding-bottom:2px;padding-top:2px'><span style='display: inline-block;width: 10px; height: 10px; background-color:" + colorganador + "; margin-right: 4px;margin-bottom:-1px'></span><span style='font-size:15px; color:" + colorganador + "'><b>" + ganador + "</b></span></td><td style='text-align:right;padding-bottom:3px;padding-top:2px;font-size:15px;font-family: Open Sans; color:" + colorganador + "'<td style='text-align:right;padding-bottom:3px;padding-top:2px;font-size:12px;font-family: OpenSans-bold, Open Sans;'><b>" + pganador + "</b></span></td></tr><tr style='border-bottom: 1px solid #ddd;'><td style='padding-bottom:2px;padding-top:2px'><span style='display: inline-block;width: 10px; height: 10px; background-color:" + colorsegundo + "; margin-right: 4px;margin-bottom:-1px'></span><span style='font-size:12px;'>" + segundo + "</td><td style='text-align:right;padding-bottom:3px;padding-top:2px;font-size:12px;'>" + psegundo + "</td></tr><tr style='border-bottom: 1px solid #ddd;'><td style='padding-bottom:2px;padding-top:2px'><span style='display: inline-block;width: 10px; height: 10px; background-color:" + colortercero + "; margin-right: 4px;margin-bottom:-1px'></span><span style='font-size:12px;'>" + tercero + "</td><td style='text-align:right;padding-bottom:3px;padding-top:2px;font-size:12px;'>" + ptercero + "</td></tr><tr style='border-bottom: 1px solid #ddd;'><td style='padding-bottom:2px;padding-top:2px'><span style='display: inline-block;width: 10px; height: 10px; background-color:" + colorcuarto + "; margin-right: 4px;margin-bottom:-1px'></span><span style='font-size:12px;'>" + cuarto + "</td><td style='text-align:right;padding-bottom:3px;padding-top:2px;font-size:12px;'>" + pcuarto + "</td></tr><tr style='border-bottom: 1px solid #ddd;'><td style='padding-bottom:2px;padding-top:2px'><span style='display: inline-block;width: 10px; height: 10px; background-color:" + colorquinto + "; margin-right: 4px;margin-bottom:-1px'></span><span style='font-size:12px;'>" + quinto + "</td><td style='text-align:right;padding-bottom:3px;padding-top:2px;font-size:12px;'>" + pquinto +"</div></div>" )
            .addTo(map);
  });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultadosTodos', 
                    sourceLayer: 'ganador10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });


          // TOOLTIPS PSOE

              map.on('mousemove', 'tiles-fills-PSOE', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();

                      
                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'>" + "<span style='color:cc001e'><b>PSOE</b></br></span><b>"+ PSOE + "</b>%</div>")
                      .addTo(map);
              });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-PSOE', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });

        // TOOLTIPS PP

              map.on('mousemove', 'tiles-fills-PPNA', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();
                      var PP = e.features[0].properties.PPNA.toLocaleString();
                      var Cs = e.features[0].properties.Cs.toLocaleString();
                      var PODEMOS = e.features[0].properties.PODEMOS.toLocaleString();
                      var VOX = e.features[0].properties.VOX.toLocaleString();
                      var Indepes = e.features[0].properties.Regionalistas.toLocaleString();
                      
                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><span style='color:3dc8ff'><b>PP</b></br></span><b>" + PP + " %</div>")
                      .addTo(map);
              });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-PPNA', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });

              // TOOLTIPS CIUDADANOS

              map.on('mousemove', 'tiles-fills-Cs', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();
                      var PP = e.features[0].properties.PPNA.toLocaleString();
                      var Cs = e.features[0].properties.Cs.toLocaleString();
                      var PODEMOS = e.features[0].properties.PODEMOS.toLocaleString();
                      var VOX = e.features[0].properties.VOX.toLocaleString();
                      var Indepes = e.features[0].properties.Regionalistas.toLocaleString();
                      
                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><span style='color:ff9324'><b>Cs</b></br></span><b>" + Cs + " %</div>")
                      .addTo(map);
              });   
            
            
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-Cs', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });

// TOOLTIPS PODEMOS

              map.on('mousemove', 'tiles-fills-PODEMOS', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();
                      var PP = e.features[0].properties.PPNA.toLocaleString();
                      var Cs = e.features[0].properties.Cs.toLocaleString();
                      var PODEMOS = e.features[0].properties.PODEMOS.toLocaleString();
                      var VOX = e.features[0].properties.VOX.toLocaleString();
                      var Indepes = e.features[0].properties.Regionalistas.toLocaleString();
                      
                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><span style='color:ad18ad'><b>Podemos</b></br></span><b>" + PODEMOS + " %</div>")
                      .addTo(map);
              });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-PODEMOS', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });  

              // TOOLTIPS VOX

              map.on('mousemove', 'tiles-fills-VOX', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();
                      var PP = e.features[0].properties.PPNA.toLocaleString();
                      var Cs = e.features[0].properties.Cs.toLocaleString();
                      var PODEMOS = e.features[0].properties.PODEMOS.toLocaleString();
                      var VOX = e.features[0].properties.VOX.toLocaleString();
                      var Indepes = e.features[0].properties.Regionalistas.toLocaleString();

                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><span style='color:3c8c04'><b>Vox</b></br></span><b>" + VOX + " %</div>")
                      .addTo(map);
              });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-VOX', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });    

              // TOOLTIPS INDEPES

              map.on('mousemove', 'tiles-fills-Regionalistas', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();
                      var PP = e.features[0].properties.PPNA.toLocaleString();
                      var Cs = e.features[0].properties.Cs.toLocaleString();
                      var PODEMOS = e.features[0].properties.PODEMOS.toLocaleString();
                      var VOX = e.features[0].properties.VOX.toLocaleString();
                      var Indepes = e.features[0].properties.Regionalistas.toLocaleString();
                      
                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><span style='color:dec800'><b>Nacionalistas</b></br></span><b>" + Indepes + " %</div>")
                      .addTo(map);
              });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-Regionalistas', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });   



              // TOOLTIPS MASPAIS

              map.on('mousemove', 'tiles-fills-COMPROMIS', function(e) {
                if (e.features.length > 0) {
                  if (hoveredStateId) {          
                    map.setFeatureState({ source: 'resultados', 
                      sourceLayer: 'fuerzasr10N',
                      id: hoveredStateId}, { hover: false});
                  }
                  hoveredStateId = e.features[0].id;
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: true});
                }
                map.getCanvas().style.cursor = 'pointer';

                      //var coordinates = e.features[0].geometry.coordinates.slice();
                      var villa = e.features[0].properties.MUNICIPIO.toLocaleString();
                      var PSOE = e.features[0].properties.PSOE.toLocaleString();
                      var PP = e.features[0].properties.PPNA.toLocaleString();
                      var Cs = e.features[0].properties.Cs.toLocaleString();
                      var PODEMOS = e.features[0].properties.PODEMOS.toLocaleString();
                      var VOX = e.features[0].properties.VOX.toLocaleString();
                      var Indepes = e.features[0].properties.Regionalistas.toLocaleString();
                      var MPAIS = e.features[0].properties.COMPROMIS.toLocaleString();

                      
                      popup.setLngLat(e.lngLat)
                      .setHTML("<div style='color:black;font-size:12px;font-family: OpenSans-bold, Open Sans;padding-bottom:3px'><b>" + villa + "</b></div><hr><div style='padding-top: 4px; font-size: 14px;font-family: Open Sans;text-align: center;'><span style='color:05dfc6'><b>Más País</b></br></span><b>" + MPAIS + " %</div>")
                      .addTo(map);
              });   
                      
              // Change the cursor style as a UI indicator.        
              // Display a popup with the name of the county
              map.on('mouseleave', 'tiles-fills-COMPROMIS', function() {
                map.getCanvas().style.cursor = '';
                popup.remove();
                if (hoveredStateId) {          
                  map.setFeatureState({ source: 'resultados', 
                    sourceLayer: 'fuerzasr10N',
                    id: hoveredStateId}, { hover: false});
                }
                hoveredStateId = null;
              });  
        }); // CLOSE map.onLoad

//cc001e > PSOE  //#3dc8ff > PP  //#ad18ad > PODEMOS  //#ff9324 > CIUDADANOS
              //#3c8c04 > VOX  //#ffd332 > INDEPES   //#ed5975 > junts per cat   //#2b7438 > PNV  //#a2d213 > EHbildu  //#05dfc6 > MAS PAIS  //#abaf1d > PACMA  //#fff200 > CUP

       // BOTONES PARTIDOS
        var toggleableLayerIds = ['TODOS','PSOE', 'PPNA', 'Cs', 'PODEMOS', 'VOX', 'COMPROMIS', 'Regionalistas']; 
        // Poner los partidos por orden en el que han ganado? // CAMBIAR COMPROMIS POR MAS PAIS
        var colors = ["#565454", "#cc001e", "#3dc8ff", "#ff9324", "#ad18ad", "#3c8c04", "#05dfc6", "#ffd332"];
        // Colores de cada partido de toogleableLayerIds, las posiciones tienen que ser las mismas.

        for (var i = 0; i < toggleableLayerIds.length; i++) {
            var id = toggleableLayerIds[i];
            var link = document.createElement('a');
            link.href = '#';
            link.className = 'desactive';
            link.id = id;
            link.textContent = id;
            if(i == 0){
              link.className = 'active';
            }

            link.onclick = function (e) {
              var clickedLayer = this.textContent;
              e.preventDefault();
              e.stopPropagation();
              var visibility = map.getLayoutProperty('tiles-fills-PSOE', 'visibility');

              if (visibility === 'visible') {
                  for (var j = 0; j < toggleableLayerIds.length; j++) {
                    if(clickedLayer == toggleableLayerIds[j]){
                      if(clickedLayer != "TODOS"){
                        map.setFilter('tiles-fills-'+ toggleableLayerIds[j], ['>', toggleableLayerIds[j], -1]) 
                       // La capa que hemos clicado la filtra en el mapa (los valores > 1)
                        document.getElementById('legend1').style.backgroundColor = colors[j];
                        document.getElementById('legend2').style.backgroundColor = colors[j];
                        document.getElementById('legend3').style.backgroundColor = colors[j];
                        document.getElementById('legend4').style.backgroundColor = colors[j];
                        document.getElementById('legend5').style.backgroundColor = colors[j];
                        document.getElementById('legend').style.opacity = 1;
                      }
                    }else{
                       if(toggleableLayerIds[j] != "TODOS"){
                         map.setFilter('tiles-fills-'+ toggleableLayerIds[j], ['==', toggleableLayerIds[j], -1]) // Las que no hemos clicado no los filtra (valores -1, que no habrán)
                       }
                       document.getElementById(toggleableLayerIds[j]).className = 'desactive';
                    }
                    if(clickedLayer == "TODOS"){
                          map.setFilter('tiles-fills', ['>', 'Perc_PrimeraForca', -1]) // He puesto psoe, pero sirve para filtrar o no los datos del Layer ResultadosTodos.
                           document.getElementById('legend').style.opacity = 0;
                    }else{
                          map.setFilter('tiles-fills', ['==', 'Perc_PrimeraForca', -1])
                    }
                  }          
                  this.className = 'active'; 
                  //console.log(this);              
              }
            };

            var layers = document.getElementById('menuPartidos');
            layers.appendChild(link);

        }  // CLOSE for

  </script>

</body>
</html>
